@page "/autenticacion/administrarusuario/{UsuarioId:int}/{Tipo:int}"

@model SRAUMOAR.Pages.Autenticacion.AdministrarUsuarioModel

@{
    ViewData["Title"] = "Administrar usuario";
}

<div class="container-fluid py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="h3 mb-0 text-gray-800 fw-bold">Administración de Usuario</h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0 mt-2">
                    @if (ViewData["tipo"]?.ToString() == "1")
                    {
                        <li class="breadcrumb-item"><a asp-page="/alumno/Index">Alumnos</a></li>
                    }
                    else
                    {
                        <li class="breadcrumb-item"><a asp-page="/generales/docentes/Index">Docentes</a></li>
                    }
                    <li class="breadcrumb-item active" aria-current="page">Administrar Usuario</li>
                </ol>
            </nav>
        </div>
        <div>
            @if (ViewData["tipo"]?.ToString() == "1")
            {
                <a asp-page="/alumno/Index" class="btn btn-outline-secondary rounded-pill px-4 shadow-sm">
                    <i class="bi bi-arrow-left me-1"></i> Volver a Alumnos
                </a>
            }
            else
            {
                <a asp-page="/generales/docentes/Index" class="btn btn-outline-secondary rounded-pill px-4 shadow-sm">
                    <i class="bi bi-arrow-left me-1"></i> Volver a Docentes
                </a>
            }
        </div>
    </div>

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show shadow-sm rounded-4 mb-4" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i> @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Main Content -->
    <div class="row justify-content-center">
        <div class="col-xl-5 col-lg-6 col-md-8">
            
            <!-- User Info Card -->
            <div class="card shadow-sm border-0 rounded-4 mb-4 overflow-hidden">
                <div class="bg-primary text-white text-center py-4 position-relative">
                    <div class="position-absolute top-50 start-50 translate-middle" style="opacity: 0.1;">
                        <i class="bi bi-shield-lock-fill" style="font-size: 8rem;"></i>
                    </div>
                    <div class="position-relative z-1 pt-2">
                        <div class="rounded-circle bg-white d-inline-flex align-items-center justify-content-center shadow-sm mb-3" style="width: 80px; height: 80px;">
                            <i class="bi bi-person-badge text-primary fs-1"></i>
                        </div>
                        <h4 class="mb-0 fw-bold">@Model.nombre</h4>
                        <p class="text-white-50 mb-0 small text-uppercase fw-medium mt-1">@((ViewData["tipo"]?.ToString() == "1") ? "SISTEMA - ALUMNO" : "SISTEMA - DOCENTE")</p>
                    </div>
                </div>

                <div class="card-body px-4 py-4">
                    <form method="post">
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3 small"></div>
                        <input type="hidden" name="UsuarioId" value="@ViewData["usuarioid"]" />
                        <input type="hidden" name="Tipo" value="@ViewData["tipo"]" />

                        <div class="mb-3">
                            <label asp-for="Usuario.NombreUsuario" class="form-label fw-semibold text-secondary small text-uppercase">Nombre de usuario</label>
                            <div class="input-group input-group-lg shadow-sm rounded-3 overflow-hidden">
                                <span class="input-group-text bg-light border-end-0 text-muted"><i class="bi bi-person"></i></span>
                                <input asp-for="Usuario.NombreUsuario" class="form-control border-start-0 bg-light fs-6" readonly value="@Model.email" />
                            </div>
                            <span asp-validation-for="Usuario.NombreUsuario" class="text-danger small mt-1 d-block"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Usuario.Email" class="form-label fw-semibold text-secondary small text-uppercase">Correo Electrónico</label>
                            <div class="input-group input-group-lg shadow-sm rounded-3 overflow-hidden">
                                <span class="input-group-text bg-light border-end-0 text-muted"><i class="bi bi-envelope"></i></span>
                                <input asp-for="Usuario.Email" type="email" class="form-control border-start-0 bg-light fs-6" readonly value="@Model.email" />
                            </div>
                            <span asp-validation-for="Usuario.Email" class="text-danger small mt-1 d-block"></span>
                        </div>

                        <div class="mb-4">
                            <label asp-for="Usuario.Clave" class="form-label fw-semibold text-primary small text-uppercase">Nueva Contraseña</label>
                            <div class="input-group input-group-lg shadow-sm rounded-3 overflow-hidden border border-primary border-opacity-25">
                                <span class="input-group-text bg-white border-end-0 text-primary"><i class="bi bi-key"></i></span>
                                <input asp-for="Usuario.Clave" type="password" class="form-control border-start-0 fs-6" minlength="6" placeholder="Ingrese la nueva clave (min. 6 caracteres)" />
                            </div>
                            <span asp-validation-for="Usuario.Clave" class="text-danger small mt-1 d-block"></span>
                        </div>

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary btn-lg rounded-pill shadow-sm fw-bold">
                                <i class="bi bi-arrow-clockwise me-2"></i> Actualizar Contraseña
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Danger Zone Card -->
            <div class="card shadow-sm border border-danger border-opacity-25 rounded-4 bg-danger bg-opacity-10">
                <div class="card-body px-4 py-4 text-center">
                    <h6 class="fw-bold text-danger mb-3"><i class="bi bi-exclamation-triangle-fill me-2"></i> Zona de Peligro</h6>
                    <p class="text-muted small mb-3">Esta acción eliminará permanentemente las credenciales de acceso al sistema de este usuario. Los datos personales seguirán existiendo.</p>
                    
                    <form method="post" asp-page-handler="EliminarUsuario" onsubmit="return confirm('¿Está seguro que desea eliminar el usuario del sistema? Esta acción no se puede deshacer.');">
                        <input type="hidden" name="UsuarioId" value="@ViewData["usuarioid"]" />
                        <input type="hidden" name="Tipo" value="@ViewData["tipo"]" />
                        <div class="d-grid">
                            <button type="submit" class="btn btn-outline-danger rounded-pill fw-medium">
                                <i class="bi bi-trash3 me-1"></i> Eliminar Acceso al Sistema
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <style>
        .form-control:focus {
            box-shadow: none;
            border-color: #dee2e6;
        }
        .input-group:focus-within {
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25) !important;
            border-color: #0d6efd;
        }
        .input-group:focus-within .input-group-text, 
        .input-group:focus-within .form-control {
            border-color: #0d6efd;
        }
    </style>
}
